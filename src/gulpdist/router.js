import{Router}from"express";import body_parser from"body-parser";import users from"./public/json_files/users.json" assert { type: "json" };import path from"path";import fs from"fs";const router=Router(),__dirname=path.resolve()+"/public";router.use(body_parser.json()),router.use(body_parser.urlencoded({extended:!0})),router.get("/",((e,r,s)=>{r.render("index",{users:users}),s()})),router.post("/editmail",((e,r,s)=>{var t=e.body.text,o=parseInt(e.body.user);for(let e of users)e.id===o&&/^[A-Z0-9._%+-]+@[A-Z0-9-]+.+.[A-Z]{2,4}$/i.test(t)&&(e.mail=t);fs.writeFileSync(__dirname+"/json_files/users.json",JSON.stringify(users)),r.redirect("/"),s()})),router.post("/editdate",((e,r,s)=>{var t=e.body.text,o=parseInt(e.body.user);for(let e of users)e.id===o&&t&&(e.birthday=t);fs.writeFileSync(__dirname+"/json_files/users.json",JSON.stringify(users)),r.redirect("/"),s()})),router.post("/user/:num/addnews",((e,r,s)=>{const t=parseInt(e.params.num);var o=e.body.text,n=(new Date).toLocaleDateString();for(let e of users)e.id===t&&o&&e.messages.push({date:n,mes:o});fs.writeFileSync(__dirname+"/json_files/users.json",JSON.stringify(users)),r.redirect("/user/"+t),s()})),router.post("/editrole",((e,r,s)=>{var t=e.body.text,o=parseInt(e.body.user);for(let e of users)e.id===o&&t&&(e.role=t);fs.writeFileSync(__dirname+"/json_files/users.json",JSON.stringify(users)),r.redirect("/"),s()})),router.post("/editstat",((e,r,s)=>{var t=e.body.text,o=parseInt(e.body.user);for(let e of users)e.id===o&&t&&(e.status=t);fs.writeFileSync(__dirname+"/json_files/users.json",JSON.stringify(users)),r.redirect("/"),s()})),router.get("/user/:num",((e,r,s)=>{const t=parseInt(e.params.num);var o="";for(let e of users[t].messages)o+=e.date+":"+e.mes+"\n";r.render("user",{user:users[t],resmes:o}),s()})),router.get("/user/:num/friends",((e,r,s)=>{const t=parseInt(e.params.num);r.render("friends_list",{friends:users[t].friends,users:users}),s()})),router.get("/user/:num/news",((e,r,s)=>{const t=parseInt(e.params.num);r.render("news_list",{friends:users[t].friends,users:users}),s()}));export default router;